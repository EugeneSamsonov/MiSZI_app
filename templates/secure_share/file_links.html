{% extends "basess.html" %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
<section class="card" aria-labelledby="links-title">
  <h1 id="links-title">Ссылки для «{{ orig_file_name }}»</h1>

  <form method="post" class="link-form">
    <h2 class="h4">Создать ссылку для файла</h2>
    {% csrf_token %}
    
    <!-- Показываем форму вручную, чтобы контролировать стили -->
    <div class="form-group">
      <label for="id_blocking_date">{{ form.blocking_date.label }}</label>
      {{ form.blocking_date }}
      {% if form.blocking_date.help_text %}
      <small class="form-text text-muted">{{ form.blocking_date.help_text }}</small>
      {% endif %}
      {{ form.blocking_date.errors }}
    </div>
    
    <div class="form-group">
      <label for="id_dowload_limit">{{ form.dowload_limit.label }}</label>
      {{ form.dowload_limit }}
      {% if form.dowload_limit.help_text %}
      <small class="form-text text-muted">{{ form.dowload_limit.help_text }}</small>
      {% endif %}
      {{ form.dowload_limit.errors }}
    </div>
    
    <div class="form-actions">
      <input type="submit" value="Создать" class="button primary">
    </div>
  </form>

  <h2 class="h4">Ссылки</h2>
  {% if links %}
  <ul class="links-list">
    {% for link in links %}
      <li class="link-item">
        <div class="token">
          <code class="token-text">{{ link.token }}</code>
          <div class="token-actions">
            <button class="button small" data-token="{{ link.token }}" onclick="copyToken(event)">Копировать</button>
            <a class="button ghost small{% if not link.is_active %} disabled{% endif %}" 
               href="{% url 'share:download' link.token %}" 
               {% if not link.is_active %}aria-disabled="true" tabindex="-1"{% endif %}>
              Скачать
            </a>
          </div>
        </div>
        <div class="link-info">
          Создана: {{ link.create_date|date:"d.m.Y H:i" }} | 
          Действует до: {{ link.blocking_date|date:"d.m.Y H:i"|default:"Бессрочно" }} | 
          Скачиваний: {{ link.download_count }}/{{ link.dowload_limit|default:"∞" }} |
          Статус: <span class="status {{ link.is_active|yesno:'active,inactive' }}">{{ link.is_active|yesno:"Активна,Неактивна" }}</span>
        </div>
        {% if not link.is_active %}<div class="small-info">Ссылка отключена</div>{% endif %}
      </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="muted">Для этого файла еще нет созданных ссылок.</p>
  {% endif %}
</section>

{% endblock content %}